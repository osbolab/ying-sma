\hypertarget{classsma_1_1message__thread}{\section{sma\-:\-:message\-\_\-thread Class Reference}
\label{classsma_1_1message__thread}\index{sma\-::message\-\_\-thread@{sma\-::message\-\_\-thread}}
}


{\ttfamily \#include $<$message\-\_\-thread.\-hpp$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classsma_1_1message__thread_ae2bf5e0973518dfffdd9832a9bd4296e}{const message \& {\bfseries cmsg} () const }\label{classsma_1_1message__thread_ae2bf5e0973518dfffdd9832a9bd4296e}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
The message thread constantly tries to get a message from the assigned channel and dispatches it via the messenger's handler table. The thread loop therefore is\-:
\begin{DoxyEnumerate}
\item Lock channel
\item Wait until channel is not blocked
\item Check if any socket is ready for reading no\-: A. set blocked flag and enter select() wait B. go to 3 yes\-: A. remove one socket and unlock channel ---$>$ (another thread can now enter 1) B. read from socket into thread-\/local buffer C. parse header and go to msgr with dispatch info D. pick a handler or, if none, go to 1 E. execute handler and block F. return to 1 for a new message If handlers are reasonably short and message wait times are reasonably long then we could expect two threads to maximize usage as one is always blocked on reading while one is always executing a handler. If too many threads are in this loop then they'll contend over selecting a socket and locking the channel and it'll be worse than a smaller number of threads. Two is probably reasonable to maximize throughput.
\end{DoxyEnumerate}

The only thread-\/local state necessary is\-:
\begin{DoxyItemize}
\item the thread's read channel
\item the messenger with the handler dispatch table
\item the current message buffer, which lives for the duration of the handler. Letting the thread do the socket read into a field, and only guaranteeing its lifetime during the handler execution, means we can process messages concurrently with zero allocations. 
\end{DoxyItemize}

The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
android/core/include/sma/android/message\-\_\-thread.\-hpp\end{DoxyCompactItemize}
